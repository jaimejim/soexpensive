<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status - It's so expensive</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="monospace.css">
    <style>
        body {
            max-width: 80ch;
            padding: 2rem;
        }
        .status-line {
            font-family: 'JetBrains Mono', monospace;
            margin: 0.5rem 0;
        }
        .status-ok::before { content: "[OK] "; }
        .status-error::before { content: "[ERROR] "; }
        .status-checking::before { content: "[...] "; }
    </style>
</head>
<body>
    <h1>System Status</h1>

    <div id="statusList">
        <p class="status-line status-checking">Frontend: Checking...</p>
        <p class="status-line status-checking">API: Checking...</p>
        <p class="status-line status-checking">Database: Checking...</p>
        <p class="status-line status-checking">Products: Checking...</p>
    </div>

    <script>
        const TIMEOUT = 5000; // 5 seconds

        async function checkStatus() {
            const results = {
                frontend: 'OK',
                api: 'Checking...',
                database: 'Checking...',
                products: 'Checking...'
            };

            // Frontend is OK if this page loaded
            results.frontend = 'OK';

            // Check API and database
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), TIMEOUT);

                const response = await fetch('/api/status', {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    results.api = data.api === 'ok' ? 'OK' : `ERROR: ${data.api}`;
                    results.database = data.database === 'ok' ? 'OK' : `ERROR: ${data.database}`;
                    results.products = data.products ? `OK (${data.products} products)` : 'ERROR: No products found';
                } else {
                    results.api = `ERROR: HTTP ${response.status}`;
                    results.database = 'ERROR: API failed';
                    results.products = 'ERROR: API failed';
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    results.api = 'ERROR: Timeout after 5s';
                    results.database = 'ERROR: Timeout';
                    results.products = 'ERROR: Timeout';
                } else {
                    results.api = `ERROR: ${error.message}`;
                    results.database = 'ERROR: Cannot connect';
                    results.products = 'ERROR: Cannot connect';
                }
            }

            // Update display
            const statusList = document.getElementById('statusList');
            statusList.innerHTML = `
                <p class="status-line ${results.frontend === 'OK' ? 'status-ok' : 'status-error'}">Frontend: ${results.frontend}</p>
                <p class="status-line ${results.api === 'OK' ? 'status-ok' : 'status-error'}">API: ${results.api}</p>
                <p class="status-line ${results.database === 'OK' ? 'status-ok' : 'status-error'}">Database: ${results.database}</p>
                <p class="status-line ${results.products.startsWith('OK') ? 'status-ok' : 'status-error'}">Products: ${results.products}</p>
            `;
        }

        // Check immediately
        checkStatus();

        // Refresh every 30 seconds
        setInterval(checkStatus, 30000);
    </script>
</body>
</html>
